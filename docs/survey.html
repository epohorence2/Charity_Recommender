<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Charity Survey â€¢ Charity Advisor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a class="brand" href="index.html">
        <img src="assets/logo.svg" alt="Charity Recommender" width="36" height="36" />
        <span>Charity Advisor</span>
      </a>
      <nav>
        <a href="index.html">Home</a>
        <a href="privacy.html">Privacy</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero compact">
      <div class="container">
        <h1>Tell us about your interests and values</h1>
        <p class="lead">We only keep this information in your browser. Refresh the page to start over.</p>
      </div>
    </section>

    <section class="survey" aria-labelledby="survey-title">
      <div class="container">
        <h2 id="survey-title" class="visually-hidden">Charity interest survey</h2>
        <div class="survey-layout">
          <div>
            <div id="progress" class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="4" aria-valuenow="0">
              Required questions answered: <span data-count>0</span> / 4
            </div>
            <form id="value-survey" class="question-list" novalidate>
              <div class="question-group">
                <header class="question-header">
                  <p class="question-kicker">Question 1</p>
                  <h3 class="question-title">Which broad values reflect your primary donation interest?</h3>
                </header>
                <p class="question-hint">Choose the theme that resonates most with your giving goals.</p>
                <label class="visually-hidden" for="q1">Primary donation interest</label>
                <select id="q1" name="q1" required>
                  <option value="" disabled selected hidden>Select an option</option>
                  <option value="learning">Supporting learning, creativity, and spiritual growth</option>
                  <option value="health">Addressing physical and mental health needs</option>
                  <option value="nature">Protecting nature, wildlife, and the planet</option>
                  <option value="essential">Meeting essential needs and supporting</option>
                  <option value="society">Advancing society through advocacy, research, and international work</option>
                </select>
              </div>

              <div class="question-group">
                <header class="question-header">
                  <p class="question-kicker">Question 2</p>
                  <h3 class="question-title">Where would you like to allocate your contribution?</h3>
                </header>
                <p class="question-hint">These categories update automatically after you choose Question 1.</p>
                <label class="visually-hidden" for="q2">Preferred giving category</label>
                <select id="q2" name="q2" required>
                  <option value="" disabled selected hidden>Select a category</option>
                  <optgroup label="Learning, Creativity, Spiritual Growth" data-q1="learning">
                    <option value="A">Arts, Culture, and Humanities</option>
                    <option value="B">Education</option>
                    <option value="X">Religion Related</option>
                  </optgroup>
                  <optgroup label="Physical and Mental Health" data-q1="health">
                    <option value="E">Health General and Rehabilitative</option>
                    <option value="F">Mental Health Crisis Intervention</option>
                    <option value="G">Disease Disorders Medical Disciplines</option>
                    <option value="H">Medical Research</option>
                  </optgroup>
                  <optgroup label="Nature, Wildlife, Planet" data-q1="nature">
                    <option value="C">Environmental Quality Protection and Beautification</option>
                    <option value="D">Animal Related</option>
                  </optgroup>
                  <optgroup label="Essential Needs and Support" data-q1="essential">
                    <option value="I">Crime Legal Related</option>
                    <option value="J">Employment Job Related</option>
                    <option value="K">Food Agriculture and Nutrition</option>
                    <option value="L">Housing Shelter</option>
                    <option value="M">Public Safety Disaster Preparedness and Relief</option>
                    <option value="N">Recreation Sports Leisure Athletics</option>
                    <option value="O">Youth Development</option>
                    <option value="P">Human Services Multipurpose and other</option>
                  </optgroup>
                  <optgroup label="Advancing Society" data-q1="society">
                    <option value="Q">International, Foreign Affairs</option>
                    <option value="R">Civil Rights Social Action Advocacy</option>
                    <option value="S">Community Improvement Capacity Building</option>
                    <option value="T">Philanthropy Voluntarism and Grant making Foundations</option>
                    <option value="U">Science and Technology Research Institutes Services</option>
                    <option value="V">Social Science Research Institutes</option>
                    <option value="W">Public Society Benefit Multipurpose</option>
                    <option value="Y">Mutual/Membership Benefit</option>
                  </optgroup>
                </select>
              </div>

              <div id="q3-container" class="question-group">
                <header class="question-header">
                  <p class="question-kicker">Question 3</p>
                  <h3 class="question-title">What specific focus excites you the most?</h3>
                </header>
                <p id="q3-hint" class="question-hint">Select a category in Question 2 to reveal a tailored follow-up.</p>

                <div id="q3-A" class="q3-option hidden">
                  <label for="q3-A-select">3. What is the specific artistic or cultural area you are most interested in supporting?</label>
                  <select id="q3-A-select" name="q3-A">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="A0">Museums &amp; Historical Preservation</option>
                    <option value="A1">Performing Arts</option>
                    <option value="A2">Media &amp; Communication</option>
                    <option value="A3">General Arts, Culture &amp; Education</option>
                    <option value="A4">Support for Arts Groups</option>
                  </select>
                </div>

                <div id="q3-B" class="q3-option hidden">
                  <label for="q3-B-select">3. What level or type of educational service are you most interested in supporting?</label>
                  <select id="q3-B-select" name="q3-B">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="B0">K-12 and Specialized Schools</option>
                    <option value="B1">Higher Education &amp; Vocational Training</option>
                    <option value="B2">Libraries and Student Support Services</option>
                    <option value="B3">General Educational Programs</option>
                    <option value="B4">Education Infrastructure &amp; Research</option>
                  </select>
                </div>

                <div id="q3-X" class="q3-option hidden">
                  <label for="q3-X-select">3. What is the specific religious focus or functional area you want to support?</label>
                  <select id="q3-X-select" name="q3-X">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="X0">Specific Religious Denomination</option>
                    <option value="X1">Religious Media &amp; Communications</option>
                    <option value="X2">Interfaith &amp; General religious services</option>
                    <option value="X3">Support &amp; Infrastructure for Religion</option>
                  </select>
                </div>

                <div id="q3-E" class="q3-option hidden">
                  <label for="q3-E-select">3. What is the specific setting or type of general health care you want to support?</label>
                  <select id="q3-E-select" name="q3-E">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="E0">Hospital &amp; Inpatient Care</option>
                    <option value="E1">Outpatient &amp; Community Clinics</option>
                    <option value="E2">Long-Term &amp; Home Care</option>
                    <option value="E3">Specialized Medical Support</option>
                    <option value="E4">Health Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-F" class="q3-option hidden">
                  <label for="q3-F-select">3. What is the specific type of mental health need or service you want to support?</label>
                  <select id="q3-F-select" name="q3-F">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="F0">Addiction &amp; Substance Abuse</option>
                    <option value="F1">General Mental Health Treatment</option>
                    <option value="F2">Crisis Intervention &amp; Counseling</option>
                    <option value="F3">Mental Health Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-G" class="q3-option hidden">
                  <label for="q3-G-select">3. What is the primary medical focus or function you are interested in supporting?</label>
                  <select id="q3-G-select" name="q3-G">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="G0">Diseases of Specific Organ Systems</option>
                    <option value="G1">Genetic, Birth Defects, and Specific Named Diseases</option>
                    <option value="G2">Medical Disciplines &amp; Specialties</option>
                    <option value="G3">Support &amp; Infrastructure for Disease Organizations</option>
                    <option value="G4">Policy, Advocacy &amp; Professional Support</option>
                  </select>
                </div>

                <div id="q3-H" class="q3-option hidden">
                  <label for="q3-H-select">3. What is the specific subject area or function of medical research you want to support?</label>
                  <select id="q3-H-select" name="q3-H">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="H0">Research on Specific Diseases &amp; Defects</option>
                    <option value="H1">Research on Organ &amp; System Disorders</option>
                    <option value="H2">Medical Specialty &amp; Discipline Research</option>
                    <option value="H3">Research Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-C" class="q3-option hidden">
                  <label for="q3-C-select">3. What is the specific environmental goal or activity you want to support?</label>
                  <select id="q3-C-select" name="q3-C">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="C0">Pollution &amp; Resource Management</option>
                    <option value="C1">Land &amp; Habitat Conservation</option>
                    <option value="C2">Beautification &amp; Education</option>
                    <option value="C3">Environmental Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-D" class="q3-option hidden">
                  <label for="q3-D-select">3. What is the specific type of animal or activity you want to support?</label>
                  <select id="q3-D-select" name="q3-D">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="D0">Domestic &amp; Companion Animal Welfare</option>
                    <option value="D1">Wildlife Conservation &amp; Sanctuaries</option>
                    <option value="D2">Animal Facilities &amp; General Services</option>
                    <option value="D3">Animal Support &amp; Infrastructure</option>
                  </select>
                </div>

                <div id="q3-I" class="q3-option hidden">
                  <label for="q3-I-select">3. Which aspect of the crime and legal system are you most interested in supporting?</label>
                  <select id="q3-I-select" name="q3-I">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="I0">Prevention and Protection</option>
                    <option value="I1">Correctional &amp; Re-Entry Services</option>
                    <option value="I2">Law Enforcement &amp; Judicial Administration</option>
                    <option value="I3">Legal Services</option>
                    <option value="I4">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-J" class="q3-option hidden">
                  <label for="q3-J-select">3. What is the specific type of employment service you want to support?</label>
                  <select id="q3-J-select" name="q3-J">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="J0">Job Training &amp; Placement</option>
                    <option value="J1">Vocational Rehabilitation &amp; Supported Work</option>
                    <option value="J2">Labor &amp; Professional Organizations</option>
                    <option value="J3">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-K" class="q3-option hidden">
                  <label for="q3-K-select">3. Which specific area related to food, agriculture, or nutrition are you most interested in supporting?</label>
                  <select id="q3-K-select" name="q3-K">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="K0">Hunger Relief &amp; Food Service</option>
                    <option value="K1">Agriculture &amp; Food Production</option>
                    <option value="K2">Nutrition &amp; Home Economics</option>
                    <option value="K3">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-L" class="q3-option hidden">
                  <label for="q3-L-select">3. What specific aspect of housing and shelter are you most interested in supporting?</label>
                  <select id="q3-L-select" name="q3-L">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="L0">Development &amp; Long-Term Housing</option>
                    <option value="L1">Emergency &amp; Temporary Shelter</option>
                    <option value="L2">Housing Support Services</option>
                    <option value="L3">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-M" class="q3-option hidden">
                  <label for="q3-M-select">3. What specific aspect of public safety or emergency management are you most interested in supporting?</label>
                  <select id="q3-M-select" name="q3-M">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="M0">Emergency Response &amp; Relief</option>
                    <option value="M1">Safety and Prevention</option>
                    <option value="M2">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-N" class="q3-option hidden">
                  <label for="q3-N-select">3. What is the specific type of sports, leisure, or recreation activity you want to support?</label>
                  <select id="q3-N-select" name="q3-N">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="N0">Facilities &amp; General Recreation</option>
                    <option value="N1">Amateur Sports &amp; Clubs</option>
                    <option value="N2">Sport Competitions &amp; Events</option>
                    <option value="N3">Professional Sports &amp; Athletics</option>
                    <option value="N4">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-O" class="q3-option hidden">
                  <label for="q3-O-select">3. What specific focus of youth development do you want to support?</label>
                  <select id="q3-O-select" name="q3-O">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="O0">Youth Centers &amp; Clubs</option>
                    <option value="O1">Mentoring &amp; Core Membership Programs</option>
                    <option value="O2">Specific Development Programs</option>
                    <option value="O3">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-P" class="q3-option hidden">
                  <label for="q3-P-select">3. What is the primary population you want to support?</label>
                  <select id="q3-P-select" name="q3-P">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="P0">Family &amp; Child Services</option>
                    <option value="P1">Services for Specific Populations</option>
                    <option value="P2">Emergency &amp; Basic Assistance</option>
                    <option value="P3">Residential &amp; Custodial Care</option>
                    <option value="P4">Multipurpose &amp; Personal Services</option>
                    <option value="P5">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-Q" class="q3-option hidden">
                  <label for="q3-Q-select">3. What is the specific focus of your international donation interest?</label>
                  <select id="q3-Q-select" name="q3-Q">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="Q0">International Aid &amp; Development</option>
                    <option value="Q1">International Understanding &amp; Exchange</option>
                    <option value="Q2">Peace, Security, and Foreign Policy</option>
                    <option value="Q3">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-R" class="q3-option hidden">
                  <label for="q3-R-select">3. What is the primary subject of the social action you want to support?</label>
                  <select id="q3-R-select" name="q3-R">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="R0">Rights for Specific Groups</option>
                    <option value="R1">Civil Liberties &amp; Social Issues</option>
                    <option value="R2">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-S" class="q3-option hidden">
                  <label for="q3-S-select">3. What is the primary area of community development or improvement you want to support?</label>
                  <select id="q3-S-select" name="q3-S">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="S0">Community &amp; Neighborhood Improvement</option>
                    <option value="S1">Economic &amp; Rural Development</option>
                    <option value="S2">Business, Industry &amp; Service</option>
                    <option value="S3">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-T" class="q3-option hidden">
                  <label for="q3-T-select">3. What is the specific type of foundation you want to support?</label>
                  <select id="q3-T-select" name="q3-T">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="T0">Private Grantmaking Foundations</option>
                    <option value="T1">Public Foundations &amp; Giving</option>
                    <option value="T2">Voluntarism &amp; Promotion</option>
                    <option value="T3">Philanthropic Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-U" class="q3-option hidden">
                  <label for="q3-U-select">3. Which specific scientific discipline or focus of the research you want to support?</label>
                  <select id="q3-U-select" name="q3-U">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="U0">Physical &amp; Earth Sciences</option>
                    <option value="U1">Engineering &amp; Applied Technology</option>
                    <option value="U2">Biological &amp; Life Sciences</option>
                    <option value="U3">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-V" class="q3-option hidden">
                  <label for="q3-V-select">3. Which specific discipline of social science research do you want to support?</label>
                  <select id="q3-V-select" name="q3-V">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="V0">Traditional Social Sciences</option>
                    <option value="V1">Interdisciplinary &amp; Area Studies</option>
                    <option value="V2">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-W" class="q3-option hidden">
                  <label for="q3-W-select">3. What specific area of public benefit or civic affair are you most interested in supporting?</label>
                  <select id="q3-W-select" name="q3-W">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="W0">Consumer Protection &amp; Civic Affairs</option>
                    <option value="W1">Under-Represented Populations</option>
                    <option value="W2">Infrastructure &amp; Policy</option>
                  </select>
                </div>

                <div id="q3-Y" class="q3-option hidden">
                  <label for="q3-Y-select">3. What type of membership or mutual benefit organization do you want to support?</label>
                  <select id="q3-Y-select" name="q3-Y">
                    <option value="" disabled selected hidden>Select a specific area</option>
                    <option value="Y0">Benefit &amp; Mutual Aid</option>
                    <option value="Y1">Associations &amp; Alliances</option>
                    <option value="Y2">Political &amp; Public Administration</option>
                    <option value="Y3">Infrastructure &amp; Management</option>
                  </select>
                </div>
              </div>

              <div class="question-group">
                <header class="question-header">
                  <p class="question-kicker">Question 4</p>
                  <h3 class="question-title">Is locality important for your donation?</h3>
                </header>
                <p class="question-hint">Choose a state to prioritize or let us know that location doesn't matter.</p>
                <label class="visually-hidden" for="q4">Preferred state or location preference</label>
                <select id="q4" name="q4" required>
                  <option value="" disabled selected hidden>Select a state or choose "Location doesn't matter"</option>
                  <option value="any">Location doesn't matter</option>
                  <option value="AL">Alabama</option>
                  <option value="AK">Alaska</option>
                  <option value="AZ">Arizona</option>
                  <option value="AR">Arkansas</option>
                  <option value="CA">California</option>
                  <option value="CO">Colorado</option>
                  <option value="CT">Connecticut</option>
                  <option value="DE">Delaware</option>
                  <option value="FL">Florida</option>
                  <option value="GA">Georgia</option>
                  <option value="HI">Hawaii</option>
                  <option value="ID">Idaho</option>
                  <option value="IL">Illinois</option>
                  <option value="IN">Indiana</option>
                  <option value="IA">Iowa</option>
                  <option value="KS">Kansas</option>
                  <option value="KY">Kentucky</option>
                  <option value="LA">Louisiana</option>
                  <option value="ME">Maine</option>
                  <option value="MD">Maryland</option>
                  <option value="MA">Massachusetts</option>
                  <option value="MI">Michigan</option>
                  <option value="MN">Minnesota</option>
                  <option value="MS">Mississippi</option>
                  <option value="MO">Missouri</option>
                  <option value="MT">Montana</option>
                  <option value="NE">Nebraska</option>
                  <option value="NV">Nevada</option>
                  <option value="NH">New Hampshire</option>
                  <option value="NJ">New Jersey</option>
                  <option value="NM">New Mexico</option>
                  <option value="NY">New York</option>
                  <option value="NC">North Carolina</option>
                  <option value="ND">North Dakota</option>
                  <option value="OH">Ohio</option>
                  <option value="OK">Oklahoma</option>
                  <option value="OR">Oregon</option>
                  <option value="PA">Pennsylvania</option>
                  <option value="RI">Rhode Island</option>
                  <option value="SC">South Carolina</option>
                  <option value="SD">South Dakota</option>
                  <option value="TN">Tennessee</option>
                  <option value="TX">Texas</option>
                  <option value="UT">Utah</option>
                  <option value="VT">Vermont</option>
                  <option value="VA">Virginia</option>
                  <option value="WA">Washington</option>
                  <option value="WV">West Virginia</option>
                  <option value="WI">Wisconsin</option>
                  <option value="WY">Wyoming</option>
                </select>
              </div>

              <div id="survey-message" class="survey-message muted" role="status" aria-live="polite" hidden></div>

              <div class="survey-actions">
                <button id="submit-survey" class="button primary" type="button">Get Survey Results</button>
                <button id="reset-survey" class="button secondary" type="button">Start Over</button>
              </div>
            </form>
          </div>

          <div class="results-panel" aria-live="polite">
            <h2 id="results-heading" class="visually-hidden" tabindex="-1">Recommendation results</h2>
            <div id="survey-error" class="alert" role="status" aria-live="polite" hidden></div>
            <div id="results" role="list" class="card-stack" aria-live="polite"></div>
            <button id="load-more" class="button secondary" type="button" hidden disabled>Load more</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>_____</p>
      <div class="footer-links">
        <a href="index.html">Home</a>
        <a href="privacy.html">Privacy</a>
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const q1Select = document.getElementById('q1');
      const q2Select = document.getElementById('q2');
      const q4Select = document.getElementById('q4');
      const q3Options = Array.from(document.querySelectorAll('.q3-option'));
      const q3Hint = document.getElementById('q3-hint');
      const messageEl = document.getElementById('survey-message');
      const submitBtn = document.getElementById('submit-survey');
      const resetBtn = document.getElementById('reset-survey');
      const progressEl = document.getElementById('progress');
      const progressCountEl = progressEl?.querySelector('[data-count]');

      const q2PlaceholderText = (q2Select.querySelector('option[value=""]')?.textContent || 'Select a category').trim();
      const q2Groups = Array.from(q2Select.querySelectorAll('optgroup[data-q1]'));
      const q2Config = q2Groups.reduce((acc, group) => {
        const key = group.dataset.q1;
        if (!key) return acc;
        acc[key] = {
          label: group.getAttribute('label') || '',
          options: Array.from(group.querySelectorAll('option')).map((option) => ({
            value: option.value,
            text: option.textContent.trim(),
          })),
        };
        return acc;
      }, {});

      function buildPlaceholderOption() {
        const option = document.createElement('option');
        option.value = '';
        option.disabled = true;
        option.selected = true;
        option.hidden = true;
        option.textContent = q2PlaceholderText;
        return option;
      }

      function resetQ2() {
        q2Select.innerHTML = '';
        q2Select.appendChild(buildPlaceholderOption());
        q2Select.value = '';
        q2Select.disabled = true;
      }

      function hideAllQ3() {
        q3Options.forEach((option) => {
          option.classList.add('hidden');
          const select = option.querySelector('select');
          if (select) {
            select.selectedIndex = 0;
          }
        });
        if (q3Hint) {
          q3Hint.classList.remove('hidden');
        }
      }

      function getActiveQ3Select() {
        const active = q3Options.find((option) => !option.classList.contains('hidden'));
        return active ? active.querySelector('select') : null;
      }

      function populateQ2For(key) {
        resetQ2();
        if (!key || !q2Config[key]) {
          updateProgressIndicator();
          return;
        }
        const { label, options } = q2Config[key];
        const optgroup = document.createElement('optgroup');
        optgroup.label = label;
        options.forEach(({ value, text }) => {
          const option = document.createElement('option');
          option.value = value;
          option.textContent = text;
          optgroup.appendChild(option);
        });
        q2Select.appendChild(optgroup);
        q2Select.disabled = false;
        updateProgressIndicator();
      }

      function showQ3For(code) {
        hideAllQ3();
        if (!code) {
          updateProgressIndicator();
          return;
        }
        const target = document.getElementById(`q3-${code}`);
        if (target) {
          target.classList.remove('hidden');
          if (q3Hint) {
            q3Hint.classList.add('hidden');
          }
        } else if (q3Hint) {
          q3Hint.classList.remove('hidden');
        }
        updateProgressIndicator();
      }

      function setMessage(text, tone = 'info') {
        if (!messageEl) return;
        if (!text) {
          messageEl.hidden = true;
          messageEl.textContent = '';
          messageEl.classList.remove('alert');
          if (!messageEl.classList.contains('muted')) {
            messageEl.classList.add('muted');
          }
          return;
        }
        messageEl.hidden = false;
        messageEl.textContent = text;
        if (tone === 'error') {
          messageEl.classList.add('alert');
          messageEl.classList.remove('muted');
        } else {
          messageEl.classList.remove('alert');
          if (!messageEl.classList.contains('muted')) {
            messageEl.classList.add('muted');
          }
        }
      }

      function getSelectedText(select) {
        if (!select) return '';
        const option = select.options[select.selectedIndex];
        return option ? option.textContent.trim() : '';
      }

      function collectAnswers() {
        const q1Value = q1Select.value;
        if (!q1Value) {
          return { error: 'Please choose a value for question 1.' };
        }
        const q2Value = q2Select.value;
        if (!q2Value) {
          return { error: 'Please choose a category for question 2.' };
        }
        const q3Select = getActiveQ3Select();
        if (!q3Select || !q3Select.value) {
          return { error: 'Please choose a focus for question 3.' };
        }
        const q4Value = q4Select.value;
        if (!q4Value) {
          return { error: 'Please choose a location preference for question 4.' };
        }

        const answers = {
          question_1: { value: q1Value, label: getSelectedText(q1Select) },
          question_2: { value: q2Value, label: getSelectedText(q2Select) },
          question_3: {
            value: q3Select.value,
            label: getSelectedText(q3Select),
            category: q3Select.id.replace('q3-', '').replace('-select', ''),
          },
          question_4: { value: q4Value, label: getSelectedText(q4Select) },
          generated_at: new Date().toISOString(),
        };

        return { answers };
      }

      function downloadAnswers(answers) {
        const blob = new Blob([JSON.stringify(answers, null, 2)], { type: 'application/json' });
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `charity-survey-${timestamp}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(link.href);
      }

      function handleSurveyExport() {
        const { answers, error } = collectAnswers();
        if (error) {
          setMessage(error, 'error');
          return;
        }
        downloadAnswers(answers);
        setMessage('Saved your responses as a JSON download.', 'success');
      }

      function updateProgressIndicator() {
        if (!progressEl) return;
        let answered = 0;
        if (q1Select.value) answered += 1;
        if (q2Select.value) answered += 1;
        const q3Select = getActiveQ3Select();
        if (q3Select && q3Select.value) answered += 1;
        if (q4Select.value) answered += 1;
        progressEl.setAttribute('aria-valuenow', String(answered));
        if (progressCountEl) {
          progressCountEl.textContent = String(answered);
        }
      }

      function resetSurvey() {
        q1Select.selectedIndex = 0;
        populateQ2For('');
        hideAllQ3();
        q2Select.disabled = true;
        q4Select.selectedIndex = 0;
        q4Select.value = '';
        setMessage('');
        updateProgressIndicator();
      }

      q1Select.addEventListener('change', () => {
        populateQ2For(q1Select.value);
        hideAllQ3();
        setMessage('');
      });

      q2Select.addEventListener('change', () => {
        if (q2Select.value) {
          showQ3For(q2Select.value);
        } else {
          hideAllQ3();
          updateProgressIndicator();
        }
        setMessage('');
      });

      q3Options.forEach((option) => {
        const select = option.querySelector('select');
        if (select) {
          select.addEventListener('change', () => {
            updateProgressIndicator();
            setMessage('');
          });
        }
      });

      submitBtn.addEventListener('click', handleSurveyExport);
      resetBtn.addEventListener('click', (event) => {
        event.preventDefault();
        resetSurvey();
      });

      resetSurvey();
    });
  </script>
  <script type="module" src="assets/survey.js"></script>
</body>
</html>
